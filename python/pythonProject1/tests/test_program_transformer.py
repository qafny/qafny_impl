# add the parent directory (root python directory) to the path
import sys
import os

script_dir = os.path.dirname(os.path.realpath(__file__))
os.chdir(script_dir)
sys.path.append("../")

# regular imports
import rich
from rich.pretty import pprint, Pretty
from rich.table import Table
from rich import box

import inspect

import suite
from suite import TestSuite

from antlr4 import FileStream, CommonTokenStream
from ExpLexer import ExpLexer
from ExpParser import ExpParser
from ProgramTransformer import ProgramTransformer

from Programmer import *

from typing import (
    Any,
    Union,
    Iterable,
    Tuple
)

import utils

# An array containing the expected results of transforming each case
# These were all hand-checked but generated from ProgramTransformer.py
TRANSFORMED_CASES = [
    QXProgram([QXMethod('hadtest', False, [QXBind('n', TySingle('nat')), QXBind('q', TyQ(QXBind('n')))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])],TyNor(),[QXTensor([QXSKet(QXNum(0.0))])])),QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], TyHad(), [QXTensor([QXSKet(QXHad('+'))], id='i', crange=QXCRange(QXNum(0.0), QXBind('n')))]))], [QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0.0))])])), QXQAssign([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], QXSingle('H')), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], TyHad(), [QXTensor([QXSKet(QXHad('+'))], id='i', crange=QXCRange(QXNum(0.0), QXBind('n')))]))])]),
    QXProgram([QXMethod('hadtest', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n')))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0.0))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0.0), QXBin('^', QXNum(2.0), QXBind('n'))))], QXBin('/', QXNum(1.0), QXUni('sqrt', QXBin('^', QXNum(2.0), QXBind('n')))), [QXSKet(QXBind('k'))])]))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], QXSingle('H')), QXCast(TyEn(QXNum(1)), [QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])])])]),
    QXProgram([QXMethod('hadtest', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n')))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0.0), QXBind('n'))])], TyEn(QXNum(1.0)), [QXSum([QXCon('k', QXCRange(QXNum(0.0), QXBin('^', QXNum(2.0), QXBind('n'))))], QXBin('/', QXNum(1.0), QXUni('sqrt', QXBin('^', QXNum(2.0), QXBind('n')))), [QXSKet(QXBind('k')), QXSKet(QXBind('k'))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0.0), QXBind('n'))])], TyEn(QXNum(2.0)), [QXSum([QXCon('j', QXCRange(QXNum(0.0), QXBin('^', QXNum(2.0), QXBind('n')))), QXCon('k', QXCRange(QXNum(0.0), QXBin('^', QXNum(2.0), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1.0), QXBin('^', QXNum(2.0), QXBind('n'))), QXCall('omega', [QXBin('*', QXBind('j'), QXBind('k')), QXNum(2.0)])), [QXSKet(QXBind('j')), QXSKet(QXBind('k'))])]))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], QXSingle('H'))])]),
    QXProgram([QXMethod('lambdatest', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('a', type=TySingle('nat')), QXBind('N', type=TySingle('nat'))], [], [QXRequires(QXComp('>', QXBind('N'), QXNum(0))), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), [QXSKet(QXBind('k')), QXSKet(QXBind('k'))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), [QXSKet(QXBind('k')), QXSKet(QXBin('%', QXBin('*', QXBind('a'), QXBind('k')), QXBind('N')))])]))], [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('*', QXBind('a'), QXBind('x')), QXBind('N')))]))])]),
    QXProgram([QXMethod('lambdatest', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('k', type=TySingle('nat'))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXBind('k'))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXBin('%', QXBin('+', QXBind('k'), QXNum(1)), QXBin('^', QXNum(2), QXBind('n'))))])]))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('+', QXBind('x'), QXNum(1)), QXBin('^', QXNum(2), QXBind('n'))))]))])]),
    QXProgram([QXMethod('lambdatest', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('k', type=TySingle('nat'))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXNum(1), QXBin('^', QXNum(2), QXBind('n'))), [QXSKet(QXBind('j')), QXSKet(QXBind('k'))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXBin('^', QXNum(2), QXBind('n'))), QXCall('omega', [QXBind('k'), QXBin('^', QXNum(2), QXBind('n'))])), [QXSKet(QXBind('j')), QXSKet(QXBind('k'))])]))], [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXOracle([QXBind('x')], QXCall('omega', [QXBind('x'), QXBin('^', QXNum(2), QXBind('n'))]), [QXSKet(QXBind('x'))]))])]),
    QXProgram([QXMethod('lambdatest', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('k', type=TySingle('nat'))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), [QXSKet(QXBin('%', QXBin('+', QXBind('j'), QXNum(1)), QXBin('^', QXNum(2), QXBind('n'))))])]))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('+', QXBind('x'), QXNum(1)), QXBin('^', QXNum(2), QXBind('n'))))]))])]),
    QXProgram([QXMethod('conditionaltest1', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('i', type=TySingle('nat')), QXBind('base', type=TySingle('nat')), QXBind('N', type=TySingle('nat'))], [], [QXRequires(QXComp('<=', QXNum(0), QXComp('<', QXBind('i'), QXBind('n')))), QXRequires(QXComp('>', QXBind('N'), QXNum(0))), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('i'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('i'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('i')))), [QXSKet(QXBind('k')), QXSKet(QXBin('%', QXBin('^', QXBind('base'), QXBind('k')), QXBind('N')))])])), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXBind('i'), QXBind('n'))])], TyHad(), [QXTensor([QXSKet(QXHad('+'))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXBin('+', QXBind('i'), QXNum(1)), QXBind('n'))])], TyHad(), [QXTensor([QXSKet(QXHad('+'))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBin('+', QXBind('i'), QXNum(1)))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBin('+', QXBind('i'), QXNum(1)))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBin('+', QXBind('i'), QXNum(1))))), [QXSKet(QXBind('k')), QXSKet(QXBin('%', QXBin('^', QXBind('base'), QXBind('k')), QXBind('N')))])]))], [QXIf(QXQRange('q', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('*', QXBin('^', QXBind('base'), QXBin('^', QXNum(2), QXBind('i'))), QXBind('x')), QXBind('N')))]))], None)])]),
    QXProgram([QXMethod('conditionaltest2', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXNum(1))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('base', type=TySingle('nat')), QXBind('N', type=TySingle('nat'))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))])], TyHad(), [QXTensor([QXSKet(QXHad('+'))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXNum(2))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXIfExp(QXComp('==', QXBind('k'), QXNum(1)), QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBin('+', QXBind('n'), QXNum(1))))), QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXNum(1))))), [QXSKet(QXBind('k')), QXSKet(QXIfExp(QXComp('==', QXBind('k'), QXNum(1)), QXBind('j'), QXNum(0)))])]))], [QXIf(QXQRange('q', [QXCRange(QXNum(0), QXNum(1))]), [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H'))], None)])]),
    QXProgram([QXMethod('conditionaltest3', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXNum(1)))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), [QXSKet(QXBind('k')), QXSKet(QXBin('%', QXBind('k'), QXNum(2)))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(2)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))), condition=QXComp('==', QXBin('%', QXBind('k'), QXNum(2)), QXNum(0)))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), [QXSKet(QXBind('k')), QXSKet(QXBin('%', QXBind('k'), QXNum(2)))]), QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))), condition=QXComp('==', QXBin('%', QXBind('k'), QXNum(2)), QXNum(1))), QXCon('j', QXCRange(QXNum(0), QXNum(2)))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBin('+', QXBind('n'), QXNum(1))))), QXCall('omega', [QXBin('*', QXBind('j'), QXBin('%', QXBind('k'), QXNum(2))), QXNum(2)])), [QXSKet(QXBind('k')), QXSKet(QXBind('j'))])]))], [QXIf(QXQRange('q', [QXCRange(QXNum(0), QXNum(1))]), [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H'))], None)])]),
    
    QXProgram([QXMethod('conditionaltest4', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('r', type=TyQ(QXNum(1))), QXBind('u', type=TyQ(QXNum(1))), QXBind('N', type=TySingle('nat'))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXNum(1), QXBin('^', QXNum(2), QXBind('n'))), [QXSKet(QXBind('k')), QXSKet(QXBind('j'))])])), QXRequires(QXQSpec([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('u', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('u', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(3)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('t', QXCRange(QXNum(0), QXNum(2)))], QXIfExp(QXComp('<', QXBind('j'), QXBind('N')), QXBin('*', QXBin('/', QXNum(1), QXBin('^', QXNum(2), QXBind('n'))), QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXNum(1))))), QXBin('/', QXNum(1), QXBin('^', QXNum(2), QXBind('n')))), [QXSKet(QXBind('k')), QXSKet(QXBind('j')), QXSKet(QXIfExp(QXComp('<', QXBind('j'), QXBind('N')), QXNum(1), QXNum(0))), QXSKet(QXIfExp(QXComp('<', QXBind('j'), QXBind('N')), QXBind('t'), QXNum(0)))])]))], [QXIf(QXQComp('<', QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXBind('N'), QXQIndex('u', QXNum(0))), [QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H'))], None)])]),
    QXProgram([QXMethod('conditionaltest5', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('r', type=TyQ(QXNum(1))), QXBind('u', type=TyQ(QXNum(1))), QXBind('N', type=TySingle('nat'))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXNum(1), QXBin('^', QXNum(2), QXBind('n'))), [QXSKet(QXBind('k')), QXSKet(QXBind('j'))])])), QXRequires(QXQSpec([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('u', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('u', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(3)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('t', QXCRange(QXNum(0), QXNum(2)))], QXIfExp(QXComp('<', QXBind('k'), QXBind('N')), QXBin('*', QXBin('/', QXNum(1), QXBin('^', QXNum(2), QXBind('n'))), QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXNum(1))))), QXBin('/', QXNum(1), QXBin('^', QXNum(2), QXBind('n')))), [QXSKet(QXBind('k')), QXSKet(QXIfExp(QXComp('<', QXBind('k'), QXBind('N')), QXIfExp(QXComp('==', QXBind('t'), QXNum(1)), QXBin('+', QXBind('j'), QXNum(1)), QXBind('j')), QXBind('j'))), QXSKet(QXIfExp(QXComp('<', QXBind('k'), QXBind('N')), QXNum(1), QXNum(0))), QXSKet(QXIfExp(QXComp('<', QXBind('k'), QXBind('N')), QXBind('t'), QXNum(0)))])]))], [QXIf(QXQComp('<', QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXBind('N'), QXQIndex('u', QXNum(0))), [QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H')), QXIf(QXQRange('r', [QXCRange(QXNum(0), QXNum(1))]), [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('x'), QXNum(1)))]))], None)], None)])]),
    QXProgram([QXMethod('postQFT', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('base', type=TySingle('nat')), QXBind('N', type=TySingle('nat'))], [], [QXRequires(QXComp('>', QXBind('N'), QXNum(0))), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), [QXSKet(QXBind('k')), QXSKet(QXBin('%', QXBin('^', QXBind('base'), QXBind('k')), QXBind('N')))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXBin('^', QXNum(2), QXBind('n'))), QXCall('omega', [QXBin('*', QXBind('j'), QXBind('k')), QXBin('^', QXNum(2), QXBind('n'))])), [QXSKet(QXBind('j')), QXSKet(QXBin('%', QXBin('^', QXBind('base'), QXBind('k')), QXBind('N')))])]))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('QFT'))])]),
    QXProgram([QXMethod('postHad', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('base', type=TySingle('nat')), QXBind('N', type=TySingle('nat'))], [], [QXRequires(QXComp('>', QXBind('N'), QXNum(0))), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), [QXSKet(QXBind('k')), QXSKet(QXBin('%', QXBin('^', QXBind('base'), QXBind('k')), QXBind('N')))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXBin('^', QXNum(2), QXBind('n'))), QXCall('omega', [QXBin('*', QXBind('j'), QXBin('%', QXBin('^', QXBind('base'), QXBind('k')), QXBind('N'))), QXNum(2)])), [QXSKet(QXBind('k')), QXSKet(QXBind('j'))])]))], [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H'))])]),
    QXProgram([QXMethod('singleGrovers', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('bool')))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], TyAA(), [QXTensor([QXPartGroup('f', QXBoolLiteral(True), QXUni('sin', QXCall('arcsin', [QXUni('sqrt', QXBin('/', QXCall('sumFun', [QXBind('f'), QXBin('^', QXNum(2.0), QXBind('n'))]), QXBin('^', QXNum(2.0), QXBind('n'))))])))]), QXTensor([QXPartGroup('f', QXBoolLiteral(False), QXUni('cos', QXCall('arcsin', [QXUni('sqrt', QXBin('/', QXCall('sumFun', [QXBind('f'), QXBin('^', QXNum(2.0), QXBind('n'))]), QXBin('^', QXNum(2.0), QXBind('n'))))])))])])), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], TyAA(), [QXTensor([QXPartGroup('f', QXBoolLiteral(True), QXUni('sin', QXBin('*', QXNum(3.0), QXCall('arcsin', [QXUni('sqrt', QXBin('/', QXCall('sumFun', [QXBind('f'), QXBin('^', QXNum(2.0), QXBind('n'))]), QXBin('^', QXNum(2.0), QXBind('n'))))]))))]), QXTensor([QXPartGroup('f', QXBoolLiteral(False), QXUni('cos', QXBin('*', QXNum(3.0), QXCall('arcsin', [QXUni('sqrt', QXBin('/', QXCall('sumFun', [QXBind('f'), QXBin('^', QXNum(2.0), QXBind('n'))]), QXBin('^', QXNum(2.0), QXBind('n'))))]))))])]))], [QXQAssign([QXQRange('p', [QXCRange(QXNum(0.0), QXBind('n'))])], QXCall('dis', [QXSingle('H'), QXBind('f'), QXUni('sqrt', QXBin('/', QXCall('sumFun', [QXBind('f'), QXBin('^', QXNum(2.0), QXBind('n'))]), QXBin('^', QXNum(2.0), QXBind('n'))))]))])]),
    QXProgram([QXMethod('singleEstimate', False, [QXBind('n', type=TySingle('nat')), QXBind('t', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('bool'))), QXBind('r', type=TySingle('real'))], [], [QXRequires(QXComp('<', QXBind('t'), QXBind('n'))), QXRequires(QXComp('==', QXBind('r'), QXUni('sqrt', QXBin('/', QXCall('sumFun', [QXBind('f'), QXBin('^', QXNum(2), QXBind('n'))]), QXBin('^', QXNum(2), QXBind('n')))))), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(2))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyAA(), [QXSum([QXCon('k', QXCRange(QXNum(0), QXNum(2)))], QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), [QXSKet(QXBind('k')), QXSKet(QXBind('k')), QXPartLambda(QXBind('f'), QXUni('sin', QXCall('arcsin', [QXBind('r')])))]), QXSum([QXCon('k', QXCRange(QXNum(0), QXNum(2)))], QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), [QXSKet(QXBind('k')), QXSKet(QXBind('k')), QXPartLambda(QXBind('f'), QXUni('cos', QXCall('arcsin', [QXBind('r')])))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(2))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyAA(), [QXSum([QXCon('k', QXCRange(QXNum(0), QXNum(2)))], QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), [QXSKet(QXBind('k')), QXSKet(QXBind('k')), QXIfExp(QXComp('==', QXBind('k'), QXNum(0)), QXPartLambda(QXBind('f'), QXUni('sin', QXCall('arcsin', [QXBind('r')]))), QXPartLambda(QXBind('f'), QXUni('sin', QXBin('*', QXNum(3), QXCall('arcsin', [QXBind('r')])))))]), QXSum([QXCon('k', QXCRange(QXNum(0), QXNum(2)))], QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), [QXSKet(QXBind('k')), QXSKet(QXBind('k')), QXIfExp(QXComp('==', QXBind('k'), QXNum(0)), QXPartLambda(QXBind('f'), QXUni('cos', QXCall('arcsin', [QXBind('r')]))), QXPartLambda(QXBind('f'), QXUni('cos', QXBin('*', QXNum(3), QXCall('arcsin', [QXBind('r')])))))])]))], [QXIf(QXQRange('x', [QXCRange(QXNum(1), QXNum(2))]), [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXCall('dis', [QXSingle('H'), QXBind('f'), QXBind('r')]))], None)])]),
    QXProgram([QXMethod('BellPair', False, [QXBind('q', type=TyQ(QXNum(2)))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(2))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(2))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXNum(2)))], QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), [QXSKet(QXBind('j')), QXSKet(QXBind('j'))])]))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H')), QXIf(QXQRange('q', [QXCRange(QXNum(0), QXNum(1))]), [QXQAssign([QXQRange('q', [QXCRange(QXNum(1), QXNum(2))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('+', QXBind('x'), QXNum(1)), QXNum(2)))]))], None)])]),
    QXProgram([QXMethod('GHZ', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n')))], [], [QXRequires(QXComp('>=', QXBind('n'), QXNum(2))), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXNum(2)))], QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), [QXSKet(QXBind('j'))])]))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H')), QXFor('i', QXCRange(QXNum(0), QXBin('-', QXBind('n'), QXNum(1))), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBin('+', QXBind('i'), QXNum(1)))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXNum(2)))], QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), [QXSKet(QXBind('j'))])])), QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXBin('+', QXBind('i'), QXNum(1)), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])]))], [QXIf(QXQRange('q', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), [QXQAssign([QXQRange('q', [QXCRange(QXBin('+', QXBind('i'), QXNum(1)), QXBin('+', QXBind('i'), QXNum(2)))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('+', QXBind('x'), QXNum(1)), QXNum(2)))]))], None)])])]),
    QXProgram([QXMethod('Teleporation', False, [QXBind('q', type=TyQ(QXNum(1))), QXBind('p', type=TyQ(QXNum(1))), QXBind('r', type=TyQ(QXNum(1)))], [QXBind('y', type=TySingle('nat')), QXBind('prob', type=TySingle('real'))], [QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXComp('==', QXBind('r'), QXBind('q')))], [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H')), QXIf(QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), [QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('+', QXBind('x'), QXNum(1)), QXNum(2)))]))], None), QXAssert(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXNum(2)))], QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), [QXSKet(QXBind('k')), QXSKet(QXBind('k'))])])), QXIf(QXQRange('q', [QXCRange(QXNum(0), QXNum(1))]), [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('+', QXBind('x'), QXNum(1)), QXNum(2)))]))], None), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H')), QXMeasure([QXBind('y'), QXBind('p1')], [QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])]), QXMeasure([QXBind('z'), QXBind('p2')], [QXQRange('q', [QXCRange(QXNum(0), QXNum(1))])]), QXIf(QXComp('==', QXBind('y'), QXNum(1)), [QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('+', QXBind('x'), QXNum(1)), QXNum(2)))]))], None), QXIf(QXComp('==', QXBind('z'), QXNum(1)), [QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x')], QXCall('omega', [QXBin('*', QXNum(1), QXBind('x')), QXNum(2)]), [QXVKet(QXBind('x'))]))], None)])]),
    QXProgram([QXInclude('BellPair.qfy'), QXMethod('Superdense', False, [QXBind('q', type=TyQ(QXNum(2))), QXBind('x', type=TySingle('bool')), QXBind('y', type=TySingle('bool'))], [QXBind('u', type=TySingle('bool')), QXBind('v', type=TySingle('bool')), QXBind('probu', type=TySingle('real')), QXBind('probv', type=TySingle('real'))], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(2))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXComp('==', QXBind('u'), QXBind('x'))), QXEnsures(QXComp('==', QXBind('v'), QXBind('y'))), QXEnsures(QXComp('==', QXBind('probu'), QXNum(1))), QXEnsures(QXComp('==', QXBind('probv'), QXNum(1)))], [QXCall('Bellpair', [QXQRange('q', [QXCRange(QXNum(0), QXNum(2))])]), QXIf(QXBind('y'), [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('x'), QXNum(1)))]))], None), QXIf(QXBind('x'), [QXQAssign([QXQRange('q', [QXCRange(QXNum(1), QXNum(2))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(1), QXNum(2)]), [QXVKet(QXBind('x'))]))], None), QXIf(QXQRange('q', [QXCRange(QXNum(0), QXNum(1))]), [QXQAssign([QXQRange('q', [QXCRange(QXNum(1), QXNum(2))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('x'), QXNum(1)))]))], None), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H')), QXMeasure([QXBind('u'), QXBind('probu')], [QXQRange('q', [QXCRange(QXNum(0), QXNum(1))])]), QXMeasure([QXBind('v'), QXBind('probv')], [QXQRange('q', [QXCRange(QXNum(1), QXNum(2))])])])]),
    
    QXProgram([QXMethod('Shors', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('n', type=TySingle('nat')), QXBind('N', type=TySingle('nat')), QXBind('base', type=TySingle('nat')), QXBind('r', type=TySingle('nat')), QXBind('c', type=TySingle('nat'))], [QXBind('y', type=TySingle('nat')), QXBind('py', type=TySingle('real'))], [QXRequires(QXComp('<', QXNum(1.0), QXComp('<', QXBind('base'), QXBind('N')))), QXRequires(QXComp('==', QXCall('gcd', [QXBind('base'), QXBind('N')]), QXNum(1.0))), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0.0))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0.0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0.0))])])), QXEnsures(QXComp('==', QXBind('y'), QXBin('/', QXBin('*', QXBind('c'), QXBin('^', QXNum(2.0), QXBind('n'))), QXBind('r')))), QXEnsures(QXComp('==', QXBind('py'), QXBin('/', QXNum(4.0), QXBin('*', QXBin('*', QXBind('pi'), QXBind('pi')), QXBind('r')))))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], QXSingle('H')), QXQAssign([QXQRange('p', [QXCRange(QXNum(0.0), QXBind('n'))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('+', QXBind('x'), QXNum(1.0)), QXNum(2.0)))])), QXFor('i', QXCRange(QXNum(0.0), QXBind('n')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('i'))]), QXQRange('p', [QXCRange(QXNum(0.0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0.0), QXBin('^', QXNum(2.0), QXBind('i'))))], QXBin('/', QXNum(1.0), QXUni('sqrt', QXBin('^', QXNum(2.0), QXBind('i')))), [QXSKet(QXBind('k')), QXSKet(QXBin('%', QXBin('^', QXBind('base'), QXBind('k')), QXBind('N')))])])), QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXBind('i'), QXBind('n'))])], TyHad(), [QXTensor([QXSKet(QXHad('+'))])]))], [QXIf(QXQRange('q', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), [QXQAssign([QXQRange('p', [QXCRange(QXNum(0.0), QXBind('n'))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('*', QXBin('^', QXBind('base'), QXBin('^', QXNum(2.0), QXBind('i'))), QXBind('x')), QXBind('N')))]))], None)]), QXMeasure([QXBind('v'), QXBind('prob')], [QXQRange('p', [QXCRange(QXNum(0.0), QXBind('n'))])]), QXQAssign([QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], QXSingle('QFT')), QXMeasure([QXBind('y'), QXBind('py')], [QXQRange('q', [QXCRange(QXNum(0.0), QXBind('n'))])], res=QXBin('/', QXBin('*', QXBind('c'), QXBin('^', QXNum(2.0), QXBind('n'))), QXBind('r')))])]),
    QXProgram([QXMethod('DeutschJozsa', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXNum(1))), QXBind('n', type=TySingle('nat')), QXBind('f', type=TyFun([TySingle('nat')], TySingle('bool')))], [QXBind('k', type=TySingle('nat')), QXBind('prob', type=TySingle('real'))], [QXRequires(QXComp('>=', QXBind('n'), QXNum(1))), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXNum(1))])])), QXRequires(QXLogic('||', QXCall('balance', [QXBind('f')]), QXCall('constant', [QXBind('f')]))), QXEnsures(QXLogic('==>', QXLogic('&&', QXCall('balance', [QXBind('f')]), QXComp('==', QXBind('k'), QXNum(0))), QXComp('==', QXBind('prob'), QXNum(0)))), QXEnsures(QXLogic('==>', QXLogic('&&', QXCall('constant', [QXBind('f')]), QXComp('==', QXBind('k'), QXNum(1))), QXComp('==', QXBind('prob'), QXNum(1))))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H')), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x'), QXBind('y')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBind('x')), QXSKet(QXBin('+', QXBind('y'), QXCall('f', [QXBind('x')])))])), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('i', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXCall('omega', [QXCall('f', [QXBind('i')]), QXNum(2)])), [QXSKet(QXBind('i')), QXSKet(QXHad('-'))])])), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(2)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('i', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXCall('omega', [QXBin('+', QXCall('f', [QXBind('i')]), QXBin('*', QXBind('i'), QXBind('j'))), QXNum(2)])), [QXSKet(QXBind('j')), QXSKet(QXHad('-'))])])), QXMeasure([QXBind('prob'), QXBind('k')], [QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])])])]),
    QXProgram([QXMethod('Simon', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('n', type=TySingle('nat')), QXBind('f', type=TyFun([TySingle('nat')], TySingle('nat'))), QXBind('s', type=TySingle('nat'))], [QXBind('y', type=TySingle('nat')), QXBind('p', type=TySingle('real'))], [QXRequires(QXAll(QXBind('k'), QXComp('<=', QXNum(0), QXComp('<', QXBind('k'), QXBin('^', QXNum(2), QXBin('-', QXBind('n'), QXNum(1))))), QXComp('==', QXCall('f', [QXCall('b2n', [QXBind('k')])]), QXCall('f', [QXBin('xor', QXBind('s'), QXBin('+', QXBind('k'), QXBin('^', QXNum(2), QXBin('-', QXBind('n'), QXNum(1)))))])))), QXRequires(QXComp('!=', QXBind('s'), QXNum(0))), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXLogic('==>', QXComp('==', QXBind('y'), QXNum(1)), QXComp('==', QXBind('p'), QXNum(0)))), QXEnsures(QXLogic('==>', QXComp('==', QXBind('y'), QXNum(0)), QXComp('==', QXBind('p'), QXBin('/', QXNum(1), QXBin('^', QXNum(2), QXBin('-', QXBind('n'), QXNum(1)))))))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXFor('i', QXCRange(QXNum(0), QXBind('n')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('i'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('i'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), [QXSKet(QXBind('k')), QXSKet(QXSumAExp(QXCon('j', QXCRange(QXNum(0), QXBind('i'))), QXQRange(QXCall('f', [QXCall('n2b', [QXBind('k')])]), [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))])))])])), QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXBind('i'), QXBind('n'))])], TyHad(), [QXTensor([QXSKet(QXHad('+'))])]))], QXIf(QXQRange('q', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), [QXIf(QXQRange('q', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXOracle([QXBind('y')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('y'), QXCall('f', [QXBind('x')])))]))], None)], None)), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('y', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n'))))), QXCall('omega', [QXBin('*', QXBind('k'), QXBind('y')), QXNum(2)])), [QXSKet(QXBind('y')), QXSKet(QXCall('f', [QXBind('k')]))])])), QXMeasure([QXBind('y'), QXBind('p')], QXBind('q'), res=QXNum(0))])]),
    QXProgram([QXMethod('DLog', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('t', type=TyQ(QXBind('n'))), QXBind('n', type=TySingle('nat')), QXBind('N', type=TySingle('nat')), QXBind('x', type=TySingle('nat')), QXBind('g', type=TySingle('nat')), QXBind('r', type=TySingle('nat')), QXBind('c', type=TySingle('nat'))], [QXBind('u', type=TySingle('nat')), QXBind('v', type=TySingle('nat')), QXBind('p', type=TySingle('real'))], [QXRequires(QXComp('<', QXNum(1), QXComp('<', QXBind('x'), QXComp('<=', QXBind('N'), QXBin('^', QXNum(2), QXBind('n')))))), QXRequires(QXComp('<', QXNum(1), QXComp('<', QXBind('g'), QXComp('<=', QXBind('N'), QXBin('^', QXNum(2), QXBind('n')))))), QXRequires(QXComp('==', QXCall('gcd', [QXBind('x'), QXBind('N')]), QXNum(1))), QXRequires(QXComp('==', QXCall('gcd', [QXBind('g'), QXBind('N')]), QXNum(1))), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('t', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXComp('==', QXBind('u'), QXBin('*', QXBind('v'), QXCall('log', [QXBind('g'), QXBind('x')])))), QXEnsures(QXComp('==', QXBind('v'), QXCall('log', [QXBind('g'), QXBind('x')]))), QXEnsures(QXComp('==', QXBind('p'), QXCall('Omega', [QXBin('/', QXNum(1), QXCall('log', [QXCall('log', [QXBind('N')])]))])))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXQAssign([QXQRange('t', [QXCRange(QXNum(0), QXBind('n'))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('x'), QXNum(1)))])), QXFor('i', QXCRange(QXNum(0), QXBind('n')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('i'))]), QXQRange('t', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('i'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('i')))), [QXSKet(QXBind('k')), QXSKet(QXBin('%', QXBin('^', QXBind('x'), QXBind('k')), QXBind('N')))])])), QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXBind('i'), QXBind('n'))])], TyHad(), [QXTensor([QXSKet(QXHad('+'))])]))], [QXIf(QXQRange('q', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), [QXQAssign([QXQRange('t', [QXCRange(QXNum(0), QXBind('n'))])], QXOracle([QXBind('a')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('*', QXBin('^', QXBind('x'), QXBin('^', QXNum(2), QXBind('i'))), QXBind('a')), QXBind('N')))]))], None)]), QXFor('i', QXCRange(QXNum(0), QXBind('n')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('i'))]), QXQRange('t', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('i')))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('i')))), QXNum(1)), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), [QXSKet(QXBind('k')), QXSKet(QXBind('j')), QXSKet(QXBin('%', QXBin('*', QXBin('^', QXBind('g'), QXBind('j')), QXBin('^', QXBind('x'), QXBind('k'))), QXBind('N')))])])), QXInvariant(QXQSpec([QXQRange('p', [QXCRange(QXBind('i'), QXBind('n'))])], TyHad(), [QXTensor([QXSKet(QXHad('+'))])]))], [QXIf(QXQRange('q', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), [QXQAssign([QXQRange('t', [QXCRange(QXNum(0), QXBind('n'))])], QXOracle([QXBind('a')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('*', QXBin('^', QXBind('g'), QXBin('^', QXNum(2), QXBind('i'))), QXBind('a')), QXBind('N')))]))], None)]), QXMeasure([QXBind('v'), QXBind('prob')], [QXQRange('t', [QXCRange(QXNum(0), QXBind('N'))])]), QXCAssign([QXBind('delta')], QXCall('log', [QXBind('g'), QXBind('v')])), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('RQFT')), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('i'))))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBind('N'))), QXCall('omega', [QXBind('k'), QXBind('delta'), QXBind('N')])), [QXSKet(QXBin('*', QXBind('k'), QXCall('log', [QXBind('g'), QXBind('x')]))), QXSKet(QXBind('k'))])])), QXMeasure([QXBind('u'), QXBind('v'), QXBind('p')], [QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])])])]),
    QXProgram([QXMethod('Diff', True, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('bool'))), QXBind('v', type=TySingle('real')), QXBind('phi', type=TySingle('real'))], [], [QXRequires(QXComp('==', QXBind('phi'), QXUni('sqrt', QXBin('/', QXCall('sumFun', [QXBind('f'), QXBin('^', QXNum(2), QXBind('n'))]), QXBin('^', QXNum(2), QXBind('n')))))), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyAA(), [QXTensor([QXPart(QXBind('n'), QXBind('f'), QXUni('sin', QXBind('v')), QXUni('cos', QXBind('v')))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyAA(), [QXTensor([QXPart(QXBind('n'), QXBind('f'), QXUni('sin', QXBin('+', QXBind('v'), QXBin('*', QXNum(2), QXBind('phi')))), QXUni('cos', QXBin('+', QXBind('v'), QXBin('*', QXNum(2), QXBind('phi')))))])]))], []), QXMethod('Grovers', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('bool'))), QXBind('m', type=TySingle('nat')), QXBind('N', type=TySingle('nat'))], [QXBind('y', type=TySingle('nat')), QXBind('p', type=TySingle('real'))], [QXRequires(QXComp('<', QXBind('m'), QXBin('^', QXNum(2), QXBind('n')))), QXRequires(QXAll(QXBind('k'), QXComp('<=', QXNum(0), QXComp('<', QXBind('k'), QXBind('m'))), QXComp('==', QXCall('f', [QXCall('n2b', [QXBind('k')])]), QXNum(1)))), QXRequires(QXAll(QXBind('k'), QXComp('<=', QXBind('m'), QXComp('<', QXBind('k'), QXBind('m'))), QXComp('==', QXCall('f', [QXCall('n2b', [QXBind('k')])]), QXNum(0)))), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXLogic('==>', QXComp('==', QXBind('N'), QXBin('*', QXBin('/', QXBind('pi'), QXNum(4)), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n'))))), QXComp('==', QXBind('p'), QXNum(1)))), QXEnsures(QXComp('==', QXCall('f', [QXCall('n2b', [QXBind('y')])]), QXNum(1)))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyAA(), [QXTensor([QXPart(QXBind('n'), QXBind('f'), QXUni('sin', QXBin('/', QXCall('sumFun', [QXBind('f'), QXBin('^', QXNum(2), QXBind('n'))]), QXBin('^', QXNum(2), QXBind('n')))), QXUni('cos', QXBin('/', QXCall('sumFun', [QXBind('f'), QXBin('^', QXNum(2), QXBind('n'))]), QXBin('^', QXNum(2), QXBind('n')))))])])), QXFor('i', QXCRange(QXNum(0), QXBind('N')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyAA(), [QXTensor([QXPart(QXBind('n'), QXBind('f'), QXUni('sin', QXBin('*', QXBin('+', QXBin('*', QXNum(2), QXBind('i')), QXNum(1)), QXUni('sqrt', QXBin('/', QXCall('sumFun', [QXBind('f'), QXBin('^', QXNum(2), QXBind('n'))]), QXBin('^', QXNum(2), QXBind('n')))))), QXUni('cos', QXBin('*', QXBin('+', QXBin('*', QXNum(2), QXBind('i')), QXNum(1)), QXUni('sqrt', QXBin('/', QXCall('sumFun', [QXBind('f'), QXBin('^', QXNum(2), QXBind('n'))]), QXBin('^', QXNum(2), QXBind('n')))))))])]))], [QXCall('Diff', [QXBind('n'), QXBind('q'), QXBind('f'), QXBin('*', QXBin('+', QXBin('*', QXNum(2), QXBind('i')), QXNum(1)), QXUni('sqrt', QXBin('/', QXCall('sumFun', [QXBind('f'), QXBin('^', QXNum(2), QXBind('n'))]), QXBin('^', QXNum(2), QXBind('n'))))), QXUni('sqrt', QXBin('/', QXCall('sumFun', [QXBind('f'), QXBin('^', QXNum(2), QXBind('n'))]), QXBin('^', QXNum(2), QXBind('n'))))])]), QXMeasure([QXBind('y'), QXBind('p')], QXBind('q'))])]),
    QXProgram([QXMethod('U', True, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('a', type=TySingle('nat'))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXVKet(QXBind('phi'))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXVKet(QXBind('phi'))], amp=QXCall('omega', [QXBind('a'), QXBin('^', QXNum(2), QXBind('n'))]))]))], []), QXMethod('repeat', False, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('a', type=TySingle('nat')), QXBind('m', type=TySingle('nat'))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXVKet(QXBind('phi'))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXVKet(QXBind('phi'))], amp=QXCall('omega', [QXBin('*', QXBind('m'), QXBind('a')), QXBin('^', QXNum(2), QXBind('n'))]))]))], [QXFor('k', QXCRange(QXNum(0), QXBind('m')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXVKet(QXBind('phi'))], amp=QXCall('omega', [QXBin('*', QXBind('k'), QXBind('a')), QXBin('^', QXNum(2), QXBind('n'))]))]))], [QXCall('U', [QXBind('n'), QXBind('q'), QXBind('a')])])]), QXMethod('QPE', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('n', type=TySingle('nat')), QXBind('lambda', type=TySingle('nat'))], [QXBind('y', type=TySingle('nat')), QXBind('p', type=TySingle('real'))], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXVKet(QXBind('phi'))])])), QXEnsures(QXLogic('==>', QXComp('==', QXBind('y'), QXBin('*', QXBind('lambda'), QXBin('^', QXNum(2), QXBind('n')))), QXComp('==', QXBind('p'), QXNum(1))))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXFor('k', QXCRange(QXNum(0), QXBind('n')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('k'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('k'))))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('k')))), QXCall('omega', [QXBin('*', QXBind('j'), QXBind('lambda')), QXNum(1)])), [QXSKet(QXBind('j')), QXVKet(QXBind('phi'))])])), QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXBind('k'), QXBind('n'))])], TyHad(), [QXTensor([QXSKet(QXHad('+'))])]))], [QXCall('repeat', [QXBind('n'), QXBind('p'), QXBind('lambda'), QXBin('^', QXNum(2), QXBind('k'))])]), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('RQFT')), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('v', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXNum(1)), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXBin('*', QXCall('omega', [QXBin('*', QXBind('j'), QXBind('lambda')), QXNum(1)]), QXCall('omega', [QXBin('*', QXNegation(QXBind('j')), QXBind('v')), QXBin('^', QXNum(2), QXBind('n'))]))), [QXSKet(QXBind('v'))])])), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('v', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXBin('^', QXNum(2), QXBind('n'))), QXCall('omega', [QXBin('-', QXBin('*', QXBin('*', QXBind('j'), QXBind('lambda')), QXBin('^', QXNum(2), QXBind('n'))), QXBin('*', QXBind('j'), QXBind('v'))), QXBin('/', QXNum(2), QXBind('n'))])), [QXSKet(QXBind('v'))])])), QXMeasure([QXBind('y'), QXBind('p')], QXBind('q'))])]),
    QXProgram([QXMethod('swap', False, [QXBind('q', type=TyQ(QXNum(1))), QXBind('p', type=TyQ(QXNum(1)))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXVKet(QXBind('x'))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXVKet(QXBind('y'))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXVKet(QXBind('y'))])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXVKet(QXBind('x'))])]))], [QXIf(QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('b')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('b'), QXNum(1)))]))], None), QXIf(QXQRange('q', [QXCRange(QXNum(0), QXNum(1))]), [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('b')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('b'), QXNum(1)))]))], None), QXIf(QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('b')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('b'), QXNum(1)))]))], None)]), QXMethod('nswap', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('n', type=TySingle('nat'))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXVKet(QXBind('x'))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXVKet(QXBind('y'))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXVKet(QXBind('y'))])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXVKet(QXBind('x'))])]))], [QXFor('i', QXCRange(QXNum(0), QXBind('n')), [QXInvariant(QXAll(QXBind('k'), QXComp('<=', QXNum(0), QXComp('<', QXBind('k'), QXBind('i'))), QXComp('==', QXQRange('q', [QXCRange(QXNum(0), QXBind('k'))]), QXCall('old', [QXQRange('p', [QXCRange(QXNum(0), QXBind('k'))])])))), QXInvariant(QXAll(QXBind('k'), QXComp('<=', QXNum(0), QXComp('<', QXBind('k'), QXBind('i'))), QXComp('==', QXQRange('p', [QXCRange(QXNum(0), QXBind('k'))]), QXCall('old', [QXQRange('q', [QXCRange(QXNum(0), QXBind('k'))])]))))], [QXCall('swap', [QXQRange('q', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), QXQRange('p', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))])])])]), QXMethod('SWAPTest', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('r', type=TyQ(QXNum(1))), QXBind('n', type=TySingle('nat'))], [QXBind('y', type=TySingle('nat')), QXBind('prob', type=TySingle('real'))], [QXRequires(QXQSpec([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], None, [QXQIndex('x', QXBind('k'))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], None, [QXQIndex('y', QXBind('j'))])])), QXEnsures(QXLogic('==>', QXComp('==', QXBind('y'), QXNum(0)), QXComp('==', QXBind('prob'), QXBin('+', QXBin('/', QXNum(1), QXNum(2)), QXBin('*', QXBin('/', QXNum(1), QXNum(2)), QXSumAExp(QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXBin('*', QXQRange('a', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1)))]), QXQRange('b', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1)))]))))))))], [QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H')), QXIf(QXQRange('r', [QXCRange(QXNum(0), QXNum(1))]), [QXCall('nswap', [QXBind('q'), QXBind('p')])], None), QXAssert(QXQSpec([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(3)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), [QXSKet(QXNum(0)), QXVKet(QXQRange('x', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1)))])), QXVKet(QXQRange('y', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))]))]), QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), [QXSKet(QXNum(1)), QXVKet(QXQRange('y', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))])), QXVKet(QXQRange('x', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1)))]))])])), QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H')), QXAssert(QXQSpec([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(4)), [QXSum([QXCon('t', QXCRange(QXNum(0), QXNum(2))), QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXNum(2)), QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2)))), [QXSKet(QXBind('t')), QXVKet(QXQRange('x', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1)))])), QXVKet(QXQRange('y', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))]))]), QXSum([QXCon('t', QXCRange(QXNum(0), QXNum(2))), QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXNum(2)), QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), QXCall('omega', [QXBind('t'), QXNum(2)]))), [QXSKet(QXBind('t')), QXVKet(QXQRange('y', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))])), QXVKet(QXQRange('x', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1)))]))])])), QXMeasureAbort([QXBind('y'), QXBind('prob')], QXBind('r'))])]),
    QXProgram([QXMethod('AmplitudeAmplification', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('A', type=TyFun([TyArray(TySingle('bool'), None)], TyArray(TySingle('bool'), None))), QXBind('n', type=TySingle('nat')), QXBind('chi', type=TyFun([TyArray(TySingle('bool'), None)], TyArray(TySingle('bool'), None))), QXBind('F', type=TyFun([TyArray(TySingle('bool'), None)], TyArray(TySingle('bool'), None)))], [QXBind('y', type=TySingle('real'))], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXComp('<', QXNum(1), QXComp('<', QXBind('c'), QXNum(2))))], [QXCAssign([QXBind('l')], QXNum(0)), QXWhile(QXBoolLiteral(True), [], [QXCAssign([QXBind('l')], QXBin('+', QXBind('l'), QXNum(1))), QXCAssign([QXBind('M')], QXCall('ceiling', [QXBin('^', QXBind('c'), QXBind('l'))])), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXBind('A')), QXMeasure([QXBind('z'), QXBind('prob')], QXBind('q')), QXIf(QXComp('==', QXCall('chi', [QXBind('z')]), QXNum(1)), [QXCAssign([QXBind('y')], QXBind('z')), QXReturn([QXBind('y')])], None), QXCAssign([QXBind('j')], QXCall('uniform', [QXNum(1), QXBind('M')])), QXQAssign(QXBind('p'), QXBind('F')), QXMeasure([QXBind('z'), QXBind('prob')], QXBind('p')), QXIf(QXComp('==', QXCall('chi', [QXBind('z')]), QXNum(1)), [QXCAssign([QXBind('y')], QXBind('z')), QXReturn([QXBind('y')])], None)])])]),
    QXProgram([QXMethod('AmplitudeEstimation', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('k', type=TyArray(TySingle('nat'), None)), QXBind('up', type=TyArray(TySingle('bool'), None)), QXBind('K', type=TyArray(TySingle('nat'), None)), QXBind('n', type=TySingle('nat')), QXBind('eps', type=TySingle('real')), QXBind('a', type=TySingle('real')), QXBind('Nshots', type=TySingle('nat'))], [QXBind('a_l', type=TySingle('real')), QXBind('a_u', type=TySingle('real'))], [], [QXCAssign([QXBind('i')], QXNum(0)), QXCAssign([QXQIndex('k', QXBind('i'))], QXNum(0)), QXCAssign([QXQIndex('up', QXBind('i'))], QXBoolLiteral(True)), QXCAssign([QXBind('ci_lb')], QXNum(0)), QXCAssign([QXBind('ci_ub')], QXBin('/', QXBind('PI'), QXNum(2))), QXCAssign([QXBind('T')], QXCall('ceiling', [QXCall('log', [QXNum(2), QXBin('/', QXBind('PI'), QXBin('*', QXNum(8), QXBind('eps')))])])), QXCAssign([QXBind('Lmax')], QXBin('^', QXCall('arcsin', [QXBin('*', QXBin('/', QXNum(2), QXBind('Nshots')), QXCall('log', [QXBin('/', QXBin('*', QXNum(2), QXBind('T')), QXBind('a'))]))]), QXBin('/', QXNum(1), QXNum(4)))), QXWhile(QXComp('>', QXBin('-', QXBind('ci_ub'), QXBind('ci_lb')), QXBin('*', QXNum(2), QXBind('eps'))), [QXInvariant(QXLogic('&&', QXComp('<', QXBind('i'), QXUni('abs', QXBind('K'))), QXComp('<', QXBind('i'), QXUni('abs', QXBind('k'))))), QXDecreases(QXBin('-', QXBind('ci_ub'), QXBind('ci_lb')))], [QXCAssign([QXBind('i')], QXBin('+', QXBind('i'), QXNum(1))), QXCAssign([QXBind('k'), QXBind('up'), QXBind('K')], QXCall('FindNextK', [QXBind('k'), QXBind('up'), QXBind('K'), QXBind('n'), QXBind('i'), QXBind('ci_lb'), QXBind('ci_ub'), QXNum(2)])), QXCAssign([QXQIndex('K', QXBind('i'))], QXBin('+', QXBin('*', QXNum(4), QXQRange('k', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))])), QXNum(2))), QXIf(QXComp('>', QXQRange('K', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), QXCall('ceiling', [QXBin('/', QXBind('Lmax'), QXBind('eps'))])), [QXCAssign([QXBind('N')], QXCall('ceiling', [QXBin('/', QXBin('/', QXBin('/', QXBin('*', QXBind('Nshots'), QXBind('Lmax')), QXBind('eps')), QXQRange('K', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))])), QXNum(10))]))], [QXCAssign([QXBind('N')], QXBind('Nshots'))]), QXIf(QXComp('==', QXQRange('k', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), QXQRange('k', [QXCRange(QXBin('-', QXBind('i'), QXNum(1)), QXBind('i'))])), [], None), QXCAssign([QXBind('eai')], QXUni('sqrt', QXBin('/', QXCall('log', [QXBin('/', QXBin('*', QXNum(2), QXBind('T')), QXBind('a'))]), QXBin('*', QXNum(2), QXBind('N'))))), QXCAssign([QXBind('ai_max')], QXCall('min', [QXNum(1), QXBin('+', QXBind('ai'), QXBind('eai'))])), QXCAssign([QXBind('ai_min')], QXCall('max', [QXNum(0), QXBin('-', QXBind('ai'), QXBind('eai'))])), QXCAssign([QXBind('ci_lb')], QXBin('/', QXBin('+', QXBin('%', QXCall('floor', [QXBin('*', QXQRange('K', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), QXBind('ci_lb'))]), QXBin('*', QXNum(2), QXBind('PI'))), QXBind('ci_min')), QXQRange('K', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]))), QXCAssign([QXBind('ci_ub')], QXBin('/', QXBin('+', QXBin('%', QXCall('floor', [QXBin('*', QXQRange('K', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), QXBind('ci_ub'))]), QXBin('*', QXNum(2), QXBind('PI'))), QXBind('ci_max')), QXQRange('K', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))])))]), QXCAssign([QXBind('a_l')], QXBin('^', QXUni('sin', QXBind('ci_lb')), QXNum(2))), QXCAssign([QXBind('a_u')], QXBin('^', QXUni('sin', QXBind('ci_ub')), QXNum(2))), QXReturn([QXBind('a_l'), QXBind('a_u')])]), QXMethod('FindNextK', False, [QXBind('k', type=TyQ(QXBind('n'))), QXBind('up', type=TyQ(QXBind('n'))), QXBind('K', type=TyQ(QXBind('n'))), QXBind('n', type=TySingle('nat')), QXBind('i', type=TySingle('nat')), QXBind('ci_lb', type=TySingle('real')), QXBind('ci_ub', type=TySingle('real')), QXBind('r', type=TySingle('nat'))], [QXBind('ki', type=TySingle('real')), QXBind('upi', type=TySingle('bool'))], [], [QXCAssign([QXQIndex('K', QXBind('i'))], QXBin('+', QXBin('*', QXNum(4), QXQRange('k', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))])), QXNum(2))), QXCAssign([QXBind('ci_min')], QXBin('*', QXQRange('K', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), QXBind('ci_lb'))), QXCAssign([QXBind('ci_max')], QXBin('*', QXQRange('K', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), QXBind('ci_ub'))), QXCAssign([QXBind('Kmax')], QXCall('floor', [QXBin('/', QXBind('PI'), QXBin('-', QXBind('ci_ub'), QXBind('ci_lb')))])), QXCAssign([QXBind('K')], QXBin('-', QXBind('Kmax'), QXBin('%', QXBin('-', QXBind('Kmax'), QXNum(2)), QXNum(4)))), QXWhile(QXComp('>=', QXBind('K'), QXBin('*', QXBind('r'), QXQRange('K', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]))), [], [QXCAssign([QXBind('q')], QXBin('/', QXBind('K'), QXQRange('K', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]))), QXIf(QXLogic('&&', QXComp('<=', QXBin('%', QXBin('*', QXBind('q'), QXBind('ci_max')), QXBin('*', QXNum(2), QXBind('PI'))), QXBind('PI')), QXComp('<=', QXBin('%', QXBin('*', QXBind('q'), QXBind('ci_min')), QXBin('%', QXNum(2), QXBind('PI'))), QXBind('PI'))), [QXCAssign([QXQIndex('K', QXBin('+', QXBind('i'), QXNum(1)))], QXBind('K')), QXCAssign([QXQIndex('up', QXBin('+', QXBind('i'), QXNum(1)))], QXBoolLiteral(True)), QXCAssign([QXQIndex('k', QXBin('+', QXBind('i'), QXNum(1)))], QXBin('/', QXBin('-', QXQRange('K', [QXCRange(QXBin('+', QXBind('i'), QXNum(1)), QXBin('+', QXBind('i'), QXNum(2)))]), QXNum(2)), QXNum(4))), QXReturn([QXBind('k'), QXBind('up'), QXBind('K')])], None), QXIf(QXLogic('&&', QXComp('>=', QXBin('%', QXBin('*', QXBind('q'), QXBind('ci_max')), QXBin('*', QXNum(2), QXBind('PI'))), QXBind('PI')), QXComp('>=', QXBin('%', QXBin('*', QXBind('q'), QXBind('ci_min')), QXBin('%', QXNum(2), QXBind('PI'))), QXBind('PI'))), [QXCAssign([QXQIndex('K', QXBin('+', QXBind('i'), QXNum(1)))], QXBind('K')), QXCAssign([QXQIndex('up', QXBin('+', QXBind('i'), QXNum(1)))], QXBoolLiteral(False)), QXCAssign([QXQIndex('k', QXBin('+', QXBind('i'), QXNum(1)))], QXBin('/', QXBin('-', QXQRange('K', [QXCRange(QXBin('+', QXBind('i'), QXNum(1)), QXBin('+', QXBind('i'), QXNum(2)))]), QXNum(2)), QXNum(4))), QXReturn([QXBind('k'), QXBind('up'), QXBind('K')])], None), QXCAssign([QXBind('K')], QXBin('-', QXBind('K'), QXNum(4)))]), QXReturn([QXBind('k'), QXBind('up'), QXBind('K')])])]),
    QXProgram([QXMethod('uf', True, [QXBind('p', type=TyQ(QXBind('n'))), QXBind('r', type=TyQ(QXNum(1))), QXBind('f', type=TyFun([TyArray(TySingle('bool'), None)], TySingle('bool'))), QXBind('n', type=TySingle('nat'))], [], [QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXBind('k')), QXSKet(QXHad('-'))], amp=QXCall('omega', [QXCall('f', [QXBind('k')]), QXNum(2)]))]))], []), QXMethod('qstep', False, [QXBind('p', type=TyQ(QXBind('n'))), QXBind('r', type=TyQ(QXNum(1))), QXBind('f', type=TyFun([TyArray(TySingle('bool'), None)], TySingle('bool'))), QXBind('n', type=TySingle('nat')), QXBind('t', type=TySingle('nat'))], [], [QXRequires(QXComp('<=', QXBind('t'), QXCall('Pow2', [QXBind('n')]))), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), [QXSKet(QXBind('k')), QXSKet(QXHad('-'))])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXTensor([QXPartWithPredicates(QXBin('^', QXNum(2), QXBind('n')), QXPartPredicate(QXBin('*', QXUni('sin', QXBin('+', QXBin('*', QXNum(2), QXBind('t')), QXNum(1))), QXBind('theta')), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(1))), QXPartPredicate(QXBin('*', QXUni('cos', QXBin('+', QXBin('*', QXNum(2), QXBind('t')), QXNum(1))), QXBind('theta')), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(0)))), QXSKet(QXHad('-'))])]))], [QXAssert(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXTensor([QXPartWithPredicates(QXBin('^', QXNum(2), QXBind('n')), QXPartPredicate(QXUni('sin', QXBind('theta')), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(1))), QXPartPredicate(QXUni('cos', QXBind('theta')), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(0)))), QXSKet(QXHad('-'))])])), QXFor('j', QXCRange(QXNum(0), QXBind('t')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXTensor([QXPartWithPredicates(QXBin('^', QXNum(2), QXBind('n')), QXPartPredicate(QXUni('sin', QXBin('+', QXBin('*', QXBin('*', QXNum(2), QXBind('j')), QXBind('theta')), QXBind('theta'))), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(1))), QXPartPredicate(QXUni('cos', QXBin('+', QXBin('*', QXBin('*', QXNum(2), QXBind('j')), QXBind('theta')), QXBind('theta'))), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(0)))), QXSKet(QXHad('-'))])]))], [QXCall('uf', [QXBind('p'), QXBind('r'), QXBind('f'), QXBind('n')]), QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('QFT')), QXIf(QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), [QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('x'), QXNum(1)))]))], None), QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('RQFT'))])]), QXMethod('AmplitudeEstimate', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('r', type=TyQ(QXNum(1))), QXBind('p', type=TyQ(QXBin('*', QXNum(2), QXBind('n')))), QXBind('f', type=TyFun([TyArray(TySingle('bool'), None)], TySingle('bool'))), QXBind('n', type=TySingle('nat')), QXBind('m', type=TySingle('nat'))], [QXBind('y', type=TySingle('nat')), QXBind('prob', type=TySingle('real'))], [QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('m'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXComp('>=', QXBind('prob'), QXBin('/', QXNum(8), QXBin('^', QXBind('pi'), QXNum(2)))))], [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('m'))])], QXSingle('H')), QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('x'), QXNum(1)))])), QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H')), QXFor('j', QXCRange(QXNum(0), QXBind('m')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('j'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('v', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('j'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('j')))), [QXSKet(QXBind('v')), QXPartWithPredicates(QXBin('^', QXNum(2), QXBind('n')), QXPartPredicate(QXBin('*', QXUni('sin', QXBin('+', QXBin('*', QXNum(2), QXBind('v')), QXNum(1))), QXBind('theta')), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(1))), QXPartPredicate(QXBin('*', QXUni('cos', QXBin('+', QXBin('*', QXNum(2), QXBind('v')), QXNum(1))), QXBind('theta')), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(0)))), QXSKet(QXHad('-'))])]))], QXIf(QXQRange('q', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))]), [QXCall('qstep', [QXBind('p'), QXBind('r'), QXBind('f'), QXBind('m'), QXBin('^', QXNum(2), QXBind('j'))])], None)), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('j'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('v', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('j'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('j')))), [QXPartWithSections([QXPartsection(QXBin('*', QXUni('sin', QXBin('+', QXBin('*', QXNum(2), QXBind('v')), QXNum(1))), QXBind('theta')), [QXSKet(QXBind('v'))], QXCall('f', [QXSKet(QXBind('k')), QXNum(1)])), QXPartsection(QXBin('*', QXUni('cos', QXBin('+', QXBin('*', QXNum(2), QXBind('v')), QXNum(1))), QXBind('theta')), [QXSKet(QXBind('v'))], QXCall('f', [QXSKet(QXBind('k')), QXNum(0)]))]), QXSKet(QXHad('-'))])])), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('j'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('v', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('j'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('j')))), [QXPartWithSections([QXPartsection(QXCall('omega', [QXBin('/', QXBin('*', QXBin('+', QXBin('*', QXNum(2), QXBind('v')), QXNum(1)), QXBind('theta')), QXBind('pi')), QXNum(1)]), [QXSKet(QXBind('v'))], QXCall('f', [QXSKet(QXBind('k')), QXNum(1)])), QXPartsection(QXCall('omega', [QXBin('/', QXBin('*', QXNegation(QXBin('+', QXBin('*', QXNum(2), QXBind('v')), QXNum(1))), QXBind('theta')), QXBind('pi')), QXNum(1)]), [QXSKet(QXBind('v'))], QXCall('f', [QXSKet(QXBind('k')), QXNum(1)]))]), QXSKet(QXHad('-'))])])), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('m'))])], QXSingle('RQFT')), QXCAssign([QXBind('y'), QXBind('prob')], QXCall('meas', [QXBind('q')]))]), QXMethod('AppxCounting', False, [QXBind('n', type=TySingle('nat')), QXBind('epsilon', type=TySingle('real')), QXBind('f', type=TyFun([TyArray(TySingle('bool'), None)], TySingle('bool')))], [QXBind('a', type=TySingle('nat'))], [QXRequires(QXComp('==', QXBin('%', QXBind('n'), QXNum(2)), QXNum(0))), QXRequires(QXComp('>', QXBind('epsilon'), QXNum(0))), QXEnsures(QXComp('<=', QXUni('abs', QXBin('-', QXBind('a'), QXBind('t'))), QXBin('/', QXNum(2), QXNum(3))))], [QXInit(QXBind('m')), QXCAssign([QXBind('m')], QXBin('/', QXBind('n'), QXNum(2))), QXInit(QXBind('l')), QXCAssign([QXBind('l')], QXNum(0)), QXInit(QXBind('t')), QXCAssign([QXBind('t')], QXNum(0)), QXWhile(QXLogic('&&', QXComp('==', QXBind('t'), QXNum(0)), QXComp('<', QXBin('^', QXNum(2), QXBind('l')), QXBin('*', QXNum(2), QXBin('^', QXNum(2), QXBind('m'))))), [QXInvariant(QXComp('<', QXBind('l'), QXBind('n'))), QXDecreases(QXBin('-', QXBin('*', QXNum(2), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXBin('^', QXNum(2), QXBind('l'))))], [QXCAssign([QXBind('l')], QXBin('+', QXBind('l'), QXNum(1))), QXQCreate(QXQRange('q', [QXCRange(QXNum(0), QXBind('l'))]), QXBind('l')), QXQCreate(QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXBind('n')), QXQCreate(QXQRange('r', [QXCRange(QXNum(0), QXNum(1))]), QXNum(1)), QXInit(QXBind('y')), QXInit(QXBind('prob')), QXCAssign([QXBind('y'), QXBind('prob')], QXCall('AmplitudeEstimate', [QXBind('q'), QXBind('r'), QXBind('p'), QXBind('f'), QXBind('n'), QXBind('l')])), QXCAssign([QXBind('t')], QXBin('*', QXBin('^', QXNum(2), QXBind('n')), QXBind('y')))]), QXInit(QXBind('M')), QXCAssign([QXBind('M')], QXCall('ceiling', [QXBin('/', QXBin('*', QXBin('*', QXNum(20), QXBin('^', QXBind('pi'), QXNum(2))), QXBind('epsilon')), QXBin('^', QXNum(2), QXBind('l')))])), QXQCreate(QXQRange('q', [QXCRange(QXNum(0), QXBind('m'))]), QXBind('m')), QXQCreate(QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXBind('n')), QXQCreate(QXQRange('r', [QXCRange(QXNum(0), QXNum(1))]), QXNum(1)), QXInit(QXBind('y')), QXInit(QXBind('prob')), QXCAssign([QXBind('y'), QXBind('prob')], QXCall('AmplitudeEstimate', [QXBind('q'), QXBind('r'), QXBind('p'), QXBind('f'), QXBind('n'), QXBind('m')])), QXCAssign([QXBind('t')], QXBin('*', QXBin('^', QXNum(2), QXBind('n')), QXBind('y'))), QXCAssign([QXBind('a')], QXCall('floor', [QXBin('+', QXBind('t'), QXNum(0.5))]))])]),
    
    QXProgram([QXMethod('HSP', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXNum(1))), QXBind('n', type=TySingle('nat')), QXBind('f', type=TyFun([TySingle('nat')], TySingle('bool'))), QXBind('g', type=TyFun([TySingle('nat')], TySingle('bool'))), QXBind('s', type=TySingle('nat'))], [QXBind('b', type=TySingle('nat')), QXBind('y', type=TySingle('nat')), QXBind('prob', type=TySingle('nat'))], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXAll(QXBind('x'), QXComp('<=', QXNum(0), QXComp('<', QXBind('x'), QXBin('^', QXNum(2), QXBind('n')))), QXComp('==', QXCall('g', [QXBind('x')]), QXCall('f', [QXBin('+', QXBind('x'), QXBind('s'))])))), QXEnsures(QXComp('==', QXBind('prob'), QXBin('-', QXNum(1), QXBin('/', QXNum(1), QXBind('q'))))), QXEnsures(QXComp('==', QXBind('s'), QXUni('not', QXBind('y')))), QXEnsures(QXComp('==', QXBind('b'), QXNum(0)))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x'), QXBind('y')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBind('x')), QXSKet(QXBin('+', QXBind('y'), QXCall('f', [QXBind('x')])))])), QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('y')], QXCall('omega', [QXBind('y'), QXNum(2)]), [QXSKet(QXBind('y'))])), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('k'))]), QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXCall('omega', [QXCall('f', [QXBind('x')]), QXNum(2)])), [QXSKet(QXBind('j')), QXSKet(QXBin('+', QXCall('f', [QXBind('x')]), QXCall('g', [QXBind('x')])))])])), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('k'))]), QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXCall('omega', [QXCall('f', [QXBind('x')]), QXNum(2)])), [QXSKet(QXBind('j')), QXSKet(QXBin('+', QXCall('f', [QXBind('x')]), QXCall('g', [QXBind('x')])))])])), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXMeasure([QXBind('y'), QXBind('b'), QXBind('prob')], [QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])])])]),
    None, # FirstAmpEstimate (in-progress)
    None, # FOQA (in-progress)
    QXProgram([QXMethod('Teleporation', False, [QXBind('q', type=TyQ(QXNum(2))), QXBind('p', type=TyQ(QXNum(1))), QXBind('r', type=TyQ(QXNum(1)))], [QXBind('y', type=TySingle('nat')), QXBind('prob', type=TySingle('real'))], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(2))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXNum(2)))], QXQRange('a', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))]), [QXSKet(QXBind('j')), QXSKet(QXBind('j'))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXNum(2)))], QXQRange('a', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))]), [QXSKet(QXBind('j')), QXSKet(QXBind('j'))])]))], [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H')), QXIf(QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), [QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('+', QXBind('x'), QXNum(1)), QXNum(2)))]))], None), QXAssert(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXNum(2)))], QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), [QXSKet(QXBind('k')), QXSKet(QXBind('k'))])])), QXIf(QXQRange('q', [QXCRange(QXNum(1), QXNum(2))]), [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('+', QXBind('x'), QXNum(1)), QXNum(2)))]))], None), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXNum(2))), QXCon('k', QXCRange(QXNum(0), QXNum(2)))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), QXQRange('a', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))])), [QXSKet(QXBind('j')), QXSKet(QXBind('j')), QXSKet(QXBin('', QXBind('j'), QXBind('k'))), QXSKet(QXBind('k'))])])), QXQAssign([QXQRange('q', [QXCRange(QXNum(1), QXNum(2))])], QXSingle('H')), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXNum(2))), QXCon('k', QXCRange(QXNum(0), QXNum(2)))], QXBin('*', QXBin('/', QXNum(1), QXNum(2)), QXQRange('a', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))])), [QXSKet(QXBind('j')), QXSKet(QXCall('P', [QXBind('j')])), QXSKet(QXBin('', QXBind('j'), QXBind('k'))), QXSKet(QXBind('k'))])])), QXMeasure([QXBind('y'), QXBind('p1')], QXBind('p')), QXAssert(QXLogic('&&', QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXNum(2))), QXCon('k', QXCRange(QXNum(0), QXNum(2)))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), QXQRange('a', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))])), [QXSKet(QXBind('j')), QXSKet(QXCall('P', [QXBind('j')])), QXSKet(QXBind('k'))])]), QXComp('==', QXBind('y'), QXBin('', QXBind('j'), QXBind('k'))))), QXMeasure([QXBind('z'), QXBind('p2')], QXBind('q')), QXAssert(QXLogic('&&', QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXNum(2))), QXCon('k', QXCRange(QXNum(0), QXNum(2)))], QXBin('*', QXQRange('a', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))]), QXCall('omega', [QXBin('*', QXBind('z'), QXBind('j')), QXNum(2)])), [QXSKet(QXBind('j')), QXSKet(QXBind('k'))])]), QXComp('==', QXBind('y'), QXBin('', QXBind('j'), QXBind('k'))))), QXIf(QXBind('y'), [QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('%', QXBin('+', QXBind('x'), QXNum(1)), QXNum(2)))]))], None), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('j', QXCRange(QXNum(0), QXNum(2)))], QXBin('*', QXQRange('a', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))]), QXCall('omega', [QXBin('*', QXBind('z'), QXBind('j')), QXNum(2)])), [QXSKet(QXBind('j')), QXSKet(QXBind('j'))])])), QXIf(QXBind('z'), [QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x')], QXCall('omega', [QXBin('*', QXNum(1), QXBind('x')), QXNum(2)]), [QXVKet(QXBind('x'))]))], None)])]), # Long Distance Entangle
    QXProgram([QXFunction('phi', False, [QXBind('n', type=TySingle('nat')), QXBind('a', type=TyFun([TySingle('nat')], TySingle('real')))], None, QXSum([QXCon('k', QXCRange(QXNum(0), QXNum(2))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), QXCall('a', [QXBind('j')])), [QXSKet(QXBind('k')), QXSKet(QXBind('j'))])), QXFunction('alpha', False, [QXBind('n', type=TySingle('nat')), QXBind('a', type=TyFun([TySingle('nat')], TySingle('real'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('real')))], None, QXSum([QXCon('k', QXCRange(QXNum(0), QXNum(2))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), QXCall('a', [QXBind('j')])), QXCall('omega', [QXBin('*', QXCall('f', [QXBind('j')]), QXBin('^', QXNum(-1), QXBind('k'))), QXBin('^', QXNum(2), QXBind('n'))])), [QXSKet(QXBind('k')), QXSKet(QXBind('j'))])), QXFunction('beta', False, [QXBind('n', type=TySingle('nat')), QXBind('a', type=TyFun([TySingle('nat')], TySingle('real'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('real')))], None, QXSum([QXCon('k', QXCRange(QXNum(0), QXNum(2))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), QXCall('a', [QXBind('j')])), QXCall('omega', [QXBin('*', QXCall('f', [QXBind('j')]), QXBin('^', QXNum(-1), QXBin('+', QXBind('k'), QXNum(1)))), QXBin('^', QXNum(2), QXBind('n'))])), [QXSKet(QXBind('k')), QXSKet(QXBind('j'))])), QXMethod('sf', True, [QXBind('n', type=TySingle('nat')), QXBind('p', type=TyQ(QXNum(1))), QXBind('q', type=TyQ(QXBind('n'))), QXBind('a', type=TyFun([TySingle('nat')], TySingle('real')))], [], [QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('phi', [QXBind('n'), QXBind('a')]))])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('phi', [QXBind('n'), QXBind('a')]))])]))], []), QXLemma('sfalpha', True, [QXBind('n', type=TySingle('nat')), QXBind('p', type=TyQ(QXNum(1))), QXBind('q', type=TyQ(QXBind('n'))), QXBind('a', type=TyFun([TySingle('nat')], TySingle('real'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('real'))), QXBind('theta', type=TySingle('real'))], [QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('alpha', [QXBind('n'), QXBind('a'), QXBind('f')]))])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('phi', [QXBind('n'), QXBind('a')]))], amp=QXBin('*', QXNum(2), QXUni('cos', QXBind('theta')))), QXTensor([QXVKet(QXCall('alpha', [QXBind('n'), QXBind('a'), QXBind('f')]))], amp=QXCall('omega', [QXNum(1), QXNum(2)]))]))]), QXLemma('sfbeta', True, [QXBind('n', type=TySingle('nat')), QXBind('p', type=TyQ(QXNum(1))), QXBind('q', type=TyQ(QXBind('n'))), QXBind('a', type=TyFun([TySingle('nat')], TySingle('real'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('real'))), QXBind('theta', type=TySingle('real'))], [QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('beta', [QXBind('n'), QXBind('a'), QXBind('f')]))])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('phi', [QXBind('n'), QXBind('a')]))], amp=QXBin('*', QXNum(2), QXUni('cos', QXBind('theta')))), QXTensor([QXVKet(QXCall('beta', [QXBind('n'), QXBind('a'), QXBind('f')]))], amp=QXCall('omega', [QXNum(1), QXNum(2)]))]))]), QXMethod('U', True, [QXBind('n', type=TySingle('nat')), QXBind('q', type=TyQ(QXBind('n'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('real')))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXBind('j'))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXBind('j'))], amp=QXCall('omega', [QXCall('f', [QXBind('j')]), QXBin('^', QXNum(2), QXBind('n'))]))]))], []), QXLemma('cuphi', True, [QXBind('n', type=TySingle('nat')), QXBind('p', type=TyQ(QXNum(1))), QXBind('q', type=TyQ(QXBind('n'))), QXBind('a', type=TyFun([TySingle('nat')], TySingle('real'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('real')))], [QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('phi', [QXBind('n'), QXBind('a')]))])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('alpha', [QXBind('n'), QXBind('a'), QXBind('f')]))])]))]), QXLemma('cubeta', True, [QXBind('n', type=TySingle('nat')), QXBind('p', type=TyQ(QXNum(1))), QXBind('q', type=TyQ(QXBind('n'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('real')))], [QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('beta', [QXBind('n'), QXBind('a'), QXBind('f')]))])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('phi', [QXBind('n'), QXBind('a')]))])]))]), QXLemma('invcuphi', True, [QXBind('n', type=TySingle('nat')), QXBind('p', type=TyQ(QXNum(1))), QXBind('q', type=TyQ(QXBind('n'))), QXBind('a', type=TyFun([TySingle('nat')], TySingle('real'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('real')))], [QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('phi', [QXBind('n'), QXBind('a')]))])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('beta', [QXBind('n'), QXBind('a'), QXBind('f')]))])]))]), QXLemma('invcualpha', True, [QXBind('n', type=TySingle('nat')), QXBind('p', type=TyQ(QXNum(1))), QXBind('q', type=TyQ(QXBind('n'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('real')))], [QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('alpha', [QXBind('n'), QXBind('a'), QXBind('f')]))])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('phi', [QXBind('n'), QXBind('a')]))])]))]), QXMethod('NonBoolean', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXNum(1))), QXBind('n', type=TySingle('nat')), QXBind('m', type=TySingle('nat')), QXBind('a', type=TyFun([TySingle('nat')], TySingle('real'))), QXBind('f', type=TyFun([TySingle('nat')], TySingle('real'))), QXBind('theta', type=TySingle('real'))], [QXBind('y', type=TySingle('nat')), QXBind('prob', type=TySingle('real'))], [QXRequires(QXComp('==', QXBind('theta'), QXBin('*', QXBin('/', QXNum(1), QXNum(2)), QXSumAExp(QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXBin('*', QXBin('*', QXBin('^', QXCall('abs', [QXCall('a', [QXBind('k')])]), QXNum(2)), QXNum(2)), QXUni('cos', QXCall('f', [QXBind('k')]))))))), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXNum(2))), QXCon('j', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXNum(2))), QXCall('a', [QXBind('j')])), [QXSKet(QXBind('k')), QXSKet(QXBind('j'))])]))], [QXFor('j', QXCRange(QXNum(0), QXBind('m')), [QXInvariant(QXLogic('==>', QXComp('==', QXBin('%', QXBind('j'), QXNum(2)), QXNum(1)), QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('phi', [QXBind('n'), QXBind('a')]))], amp=QXBin('/', QXUni('sin', QXBin('*', QXBin('+', QXBind('k'), QXNum(1)), QXBind('theta'))), QXUni('sin', QXBind('theta')))), QXTensor([QXVKet(QXCall('alpha', [QXBind('n'), QXBind('a'), QXBind('f')]))], amp=QXBin('/', QXBin('*', QXCall('omega', [QXNum(1), QXNum(2)]), QXUni('sin', QXBin('*', QXBind('k'), QXBind('theta')))), QXUni('sin', QXBind('theta'))))]))), QXInvariant(QXLogic('==>', QXComp('==', QXBin('%', QXBind('j'), QXNum(2)), QXNum(0)), QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(2)), [QXTensor([QXVKet(QXCall('phi', [QXBind('n'), QXBind('a')]))], amp=QXBin('/', QXUni('sin', QXBin('*', QXBin('+', QXBind('k'), QXNum(1)), QXBind('theta'))), QXUni('sin', QXBind('theta')))), QXTensor([QXVKet(QXCall('beta', [QXBind('n'), QXBind('a'), QXBind('f')]))], amp=QXBin('/', QXBin('*', QXCall('omega', [QXNum(1), QXNum(2)]), QXUni('sin', QXBin('*', QXBind('k'), QXBind('theta')))), QXUni('sin', QXBind('theta'))))])))], [QXIf(QXComp('==', QXBin('%', QXBind('j'), QXNum(2)), QXNum(0)), [QXIf(QXQRange('p', [QXCRange(QXNum(0), QXNum(1))]), [QXCall('U', [QXBind('q'), QXBind('n'), QXBind('f')])], None), QXAssert(QXCall('cuphi', [QXBind('n'), QXBind('p'), QXBind('q'), QXBind('a'), QXBind('f')])), QXAssert(QXCall('cubeta', [QXBind('n'), QXBind('p'), QXBind('q'), QXBind('a'), QXBind('f')]))], [QXIf(QXQNot(QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])), [QXCall('U', [QXBind('q'), QXBind('n'), QXBind('f')], inverse=True)], None), QXAssert(QXCall('invcuphi', [QXBind('n'), QXBind('p'), QXBind('q'), QXBind('a'), QXBind('f')])), QXAssert(QXCall('invcualpha', [QXBind('n'), QXBind('p'), QXBind('q'), QXBind('a'), QXBind('f')]))]), QXCall('sf', [QXBind('n'), QXBind('p'), QXBind('q'), QXBind('a')]), QXAssert(QXCall('sfalpha', [QXBind('n'), QXBind('p'), QXBind('q'), QXBind('a'), QXBind('f'), QXBind('theta')])), QXAssert(QXCall('sfbeta', [QXBind('n'), QXBind('p'), QXBind('q'), QXBind('a'), QXBind('f'), QXBind('theta')]))]), QXCAssign([QXBind('y'), QXBind('prob')], QXCall('meas', [QXQRange('p', [QXCRange(QXNum(0), QXNum(1))])]))])]),
    QXProgram([QXMethod('rzSeq', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('n', type=TySingle('nat')), QXBind('a', type=TySingle('nat'))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXBind('a'))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('i'))])], TyNor(), [QXTensor([QXSKet(QXBind('a'))], amp=QXCall('omega', [QXBind('a'), QXBin('^', QXNum(2), QXBind('n'))]))]))], [QXFor('i', QXCRange(QXNum(0), QXBind('n')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('i'))])], TyNor(), [QXTensor([QXSKet(QXBind('a'))], amp=QXCall('omega', [QXQRange('a', [QXCRange(QXNum(0), QXBind('i'))]), QXBin('^', QXNum(2), QXBind('n'))]))]))], [QXQAssign([QXQRange('q', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))])], QXOracle([QXBind('x', type=TyQ(QXNum(1)))], QXCall('omega', [QXBin('*', QXBin('^', QXNum(2), QXBind('i')), QXQRange('x', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))])), QXBin('^', QXNum(2), QXBind('n'))]), [QXSKet(QXBind('x'))]))])]), QXMethod('QPEQ', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('n', type=TySingle('nat')), QXBind('a', type=TySingle('nat')), QXBind('Q_divisor', type=TySingle('nat'))], [], [QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXCall('omega', [QXBin('*', QXBind('k'), QXBind('a')), QXBin('^', QXNum(2), QXBind('n'))])), [QXSKet(QXBind('k'))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('i'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('d', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXBin('*', QXBin('/', QXNum(1), QXBin('^', QXNum(2), QXBind('n'))), QXNum(1)), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXCall('omega', [QXBin('-', QXBin('+', QXBin('*', QXBind('k'), QXBind('a')), QXBin('*', QXBind('c'), QXBind('a'))), QXBin('*', QXBind('c'), QXBind('d'))), QXBin('^', QXNum(2), QXBind('n'))])), [QXSKet(QXBind('d')), QXSKet(QXBind('k'))])]))], [QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXFor('i', QXCRange(QXNum(0), QXBind('n')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('i'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('c', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('i')))), QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('i')))), QXNum(1)), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXCall('omega', [QXBin('+', QXBin('*', QXBind('k'), QXBind('a')), QXBin('*', QXBind('c'), QXBind('a'))), QXBin('^', QXNum(2), QXBind('n'))])), [QXSKet(QXBind('c')), QXSKet(QXBind('k'))])])), QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXBind('k'), QXBind('n'))])], TyHad(), [QXTensor([QXSKet(QXHad('+'))])])), QXSeparates([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])])], QXIf(QXQRange('q', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXOracle([QXBind('y', type=TyQ(QXBind('n')))], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('y'), QXBin('%', QXBin('^', QXNum(2), QXBind('i')), QXBind('Q_divisor'))))]))], None)), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('RQFT'))]), QXMethod('QFTModQ', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('n', type=TySingle('nat')), QXBind('a', type=TySingle('nat')), QXBind('Q_divisor', type=TySingle('nat'))], [], [QXRequires(QXAll(QXBind('k'), QXComp('<=', QXNum(0), QXComp('<', QXBind('k'), QXBin('^', QXNum(2), QXBin('-', QXBind('n'), QXNum(1))))), QXComp('==', QXCall('f', [QXCall('n2b', [QXBind('k')])]), QXCall('f', [QXBin('xor', QXBind('s'), QXCall('n2b', [QXBin('+', QXBind('k'), QXBin('^', QXNum(2), QXBind('n')))]))])))), QXRequires(QXComp('!=', QXCall('b2n', [QXBind('s')]), QXNum(0))), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXBind('a'))])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXCall('omega', [QXBin('*', QXBind('k'), QXBind('a')), QXBin('^', QXNum(2), QXBind('n'))])), [QXSKet(QXBind('k'))])]))], [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXFor('i', QXCRange(QXNum(0), QXBind('n')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('i'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('i'))))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('i')))), QXCall('omega', [QXBin('*', QXBind('k'), QXBind('a')), QXBin('^', QXNum(2), QXBind('n'))])), [QXSKet(QXBind('a')), QXSKet(QXBind('k'))])]))], QXIf(QXQRange('p', [QXCRange(QXBind('i'), QXBin('+', QXBind('i'), QXNum(1)))]), [QXCall('rzSeq', [QXBind('q'), QXBind('n'), QXBind('a')])], None)), QXCall('QPEQ', [QXBind('q'), QXBind('p'), QXBind('n'), QXBind('a'), QXBind('Q_divisor')], inverse=True), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('c', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXCall('omega', [QXBin('*', QXBind('k'), QXBind('a')), QXBin('^', QXNum(2), QXBind('n'))])), [QXSKet(QXBind('c')), QXSKet(QXBind('k'))])])), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXSum([QXCon('c', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n')))), QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('*', QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), QXCall('omega', [QXBin('*', QXBind('k'), QXBind('a')), QXBin('^', QXNum(2), QXBind('n'))])), [QXSKet(QXBind('c')), QXSKet(QXBind('k'))])])), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H'))])]),
    QXProgram([QXMethod('uf', True, [QXBind('p', type=TyQ(QXBind('n'))), QXBind('r', type=TyQ(QXNum(1))), QXBind('f', type=TyFun([TyArray(TySingle('bool'), None)], TySingle('bool'))), QXBind('n', type=TySingle('nat'))], [], [QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXBind('k')), QXSKet(QXHad('-'))], amp=QXCall('omega', [QXCall('f', [QXBind('k')]), QXNum(2)]))]))], []), QXMethod('qstep', False, [QXBind('p', type=TyQ(QXBind('n'))), QXBind('r', type=TyQ(QXNum(1))), QXBind('f', type=TyFun([TyArray(TySingle('bool'), None)], TySingle('bool'))), QXBind('n', type=TySingle('nat')), QXBind('t', type=TySingle('nat'))], [], [QXRequires(QXComp('<=', QXBind('t'), QXCall('Pow2', [QXBind('n')]))), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('k', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('n'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('n')))), [QXSKet(QXBind('k')), QXSKet(QXHad('-'))])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXTensor([QXPartWithPredicates(QXBin('^', QXNum(2), QXBind('n')), QXPartPredicate(QXBin('*', QXUni('sin', QXBin('+', QXBin('*', QXNum(2), QXBind('t')), QXNum(1))), QXBind('theta')), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(1))), QXPartPredicate(QXBin('*', QXUni('cos', QXBin('+', QXBin('*', QXNum(2), QXBind('t')), QXNum(1))), QXBind('theta')), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(0)))), QXSKet(QXHad('-'))])]))], [QXAssert(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXTensor([QXPartWithPredicates(QXBin('^', QXNum(2), QXBind('n')), QXPartPredicate(QXUni('sin', QXBind('theta')), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(1))), QXPartPredicate(QXUni('cos', QXBind('theta')), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(0)))), QXSKet(QXHad('-'))])])), QXFor('j', QXCRange(QXNum(0), QXBind('t')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXTensor([QXPartWithPredicates(QXBin('^', QXNum(2), QXBind('n')), QXPartPredicate(QXUni('sin', QXBin('+', QXBin('*', QXBin('*', QXNum(2), QXBind('j')), QXBind('theta')), QXBind('theta'))), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(1))), QXPartPredicate(QXUni('cos', QXBin('+', QXBin('*', QXBin('*', QXNum(2), QXBind('j')), QXBind('theta')), QXBind('theta'))), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(0)))), QXSKet(QXHad('-'))])]))], [QXCall('uf', [QXBind('p'), QXBind('r'), QXBind('f'), QXBind('n')]), QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXIf(QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), [QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('x'), QXNum(1)))]))], None), QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H'))])]), QXMethod('AmplitudeEstimate', False, [QXBind('q', type=TyQ(QXBind('m'))), QXBind('r', type=TyQ(QXNum(1))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('f', type=TyFun([TyArray(TySingle('bool'), None)], TySingle('bool'))), QXBind('n', type=TySingle('nat')), QXBind('m', type=TySingle('nat'))], [QXBind('y', type=TySingle('nat')), QXBind('prob', type=TySingle('real'))], [QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('m'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])])), QXEnsures(QXComp('>=', QXBind('prob'), QXBin('/', QXNum(8), QXBin('^', QXBind('pi'), QXNum(2)))))], [QXQAssign([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('m'))])], QXSingle('H')), QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('x'), QXNum(1)))])), QXQAssign([QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], QXSingle('H')), QXFor('j', QXCRange(QXNum(0), QXBind('m')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('j'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('v', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('j'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('j')))), [QXSKet(QXBind('v')), QXPartWithPredicates(QXBin('^', QXNum(2), QXBind('n')), QXPartPredicate(QXBin('*', QXUni('sin', QXBin('+', QXBin('*', QXNum(2), QXBind('v')), QXNum(1))), QXBind('theta')), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(1))), QXPartPredicate(QXBin('*', QXUni('cos', QXBin('+', QXBin('*', QXNum(2), QXBind('v')), QXNum(1))), QXBind('theta')), QXComp('==', QXCall('f', [QXSKet(QXBind('k'))]), QXNum(0)))), QXSKet(QXHad('-'))])]))], QXIf(QXQRange('q', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))]), [QXCall('qstep', [QXBind('p'), QXBind('r'), QXBind('f'), QXBind('n'), QXBin('^', QXNum(2), QXBind('j'))])], None)), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('j'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('v', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('j'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('j')))), [QXPartWithSections([QXPartsection(QXBin('*', QXUni('sin', QXBin('+', QXBin('*', QXNum(2), QXBind('v')), QXNum(1))), QXBind('theta')), [QXSKet(QXBind('v'))], QXCall('f', [QXSKet(QXBind('k')), QXNum(1)])), QXPartsection(QXBin('*', QXUni('cos', QXBin('+', QXBin('*', QXNum(2), QXBind('v')), QXNum(1))), QXBind('theta')), [QXSKet(QXBind('v'))], QXCall('f', [QXSKet(QXBind('k')), QXNum(0)]))]), QXSKet(QXHad('-'))])])), QXAssert(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('j'))]), QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))]), QXQRange('r', [QXCRange(QXNum(0), QXNum(1))])], TyEn(QXNum(1)), [QXSum([QXCon('v', QXCRange(QXNum(0), QXBin('^', QXNum(2), QXBind('j'))))], QXBin('/', QXNum(1), QXUni('sqrt', QXBin('^', QXNum(2), QXBind('j')))), [QXPartWithSections([QXPartsection(QXCall('omega', [QXBin('/', QXBin('*', QXBin('+', QXBin('*', QXNum(2), QXBind('v')), QXNum(1)), QXBind('theta')), QXBind('pi')), QXNum(1)]), [QXSKet(QXBind('v'))], QXCall('f', [QXSKet(QXBind('k')), QXNum(1)])), QXPartsection(QXCall('omega', [QXBin('/', QXBin('*', QXNegation(QXBin('+', QXBin('*', QXNum(2), QXBind('v')), QXNum(1))), QXBind('theta')), QXBind('pi')), QXNum(1)]), [QXSKet(QXBind('v'))], QXCall('f', [QXSKet(QXBind('k')), QXNum(1)]))]), QXSKet(QXHad('-'))])])), QXQAssign([QXQRange('q', [QXCRange(QXNum(0), QXBind('m'))])], QXSingle('RQFT')), QXCAssign([QXBind('y'), QXBind('prob')], QXCall('meas', [QXBind('q')]))])]),
    QXProgram([QXMethod('Stabilizer', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('k', type=TySingle('nat')), QXBind('n', type=TySingle('nat')), QXBind('a', type=TyArray(TySingle('bv1'), None)), QXBind('F', type=TyFun([TySingle('nat'), TyArray(TySingle('bool'), None)], TyArray(TySingle('bool'), None))), QXBind('H_check', type=TySet(TySingle('nat'))), QXBind('M', type=TySet(TySingle('nat')))], [QXBind('h', type=TySet(TySingle('nat')))], [QXRequires(QXComp('==', QXMemberAccess(['a', 'Length']), QXBind('n'))), QXRequires(QXAll(QXBind('k'), QXComp('<=', QXNum(0), QXComp('<', QXBind('k'), QXUni('abs', QXBind('M')))), QXComp('==', QXCall('F', [QXNum(0), QXQRange('M', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1)))])]), QXQRange('M', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1)))])))), QXRequires(QXAll(QXBind('k'), QXComp('<=', QXNum(0), QXComp('<', QXBind('k'), QXUni('abs', QXBind('M')))), QXAll(QXBind('i'), QXComp('<=', QXNum(0), QXComp('<', QXBind('i'), QXBin('^', QXNum(2), QXBind('n')))), QXAll(QXBind('j'), QXComp('<=', QXNum(0), QXComp('<', QXBind('j'), QXBin('^', QXNum(2), QXBind('n')))), QXComp('==', QXCall('F', [QXBin('+', QXBind('i'), QXBind('j')), QXQRange('M', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1)))])]), QXCall('F', [QXBind('i'), QXCall('F', [QXBind('j'), QXQRange('M', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1)))])])])))))), QXEnsures(QXLogic('==>', QXComp('!=', QXBind('h'), QXBind('null')), QXAll(QXBind('k'), QXComp('<=', QXNum(0), QXComp('<', QXBind('k'), QXUni('abs', QXBind('h')))), QXComp('==', QXCall('F', [QXQRange('h', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1)))]), QXBind('a')]), QXBind('a')))))], [QXCAssign([QXBind('h')], QXSet([])), QXCAssign([QXBind('i')], QXNum(0)), QXWhile(QXComp('<', QXBind('i'), QXCall('O', [QXBin('*', QXBin('*', QXBind('k'), QXBind('n')), QXCall('log', [QXBin('*', QXBind('k'), QXBind('n'))]))])), [QXInvariant(QXComp('<=', QXNum(0), QXComp('<=', QXBind('i'), QXCall('O', [QXBin('*', QXBin('*', QXBind('k'), QXBind('n')), QXCall('log', [QXBin('*', QXBind('k'), QXBind('n'))]))])))), QXInvariant(QXComp('==', QXUni('abs', QXBind('h')), QXBind('i'))), QXInvariant(QXAll(QXBind('k'), QXComp('<=', QXNum(0), QXComp('<', QXBind('k'), QXUni('abs', QXBind('h')))), QXComp('==', QXCall('F', [QXQRange('h', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1)))]), QXBind('a')]), QXBind('a'))))], [QXCAssign([QXBind("q'")], QXBind('q')), QXQAssign([QXQRange("q'", [QXCRange(QXNum(0), QXBind('n'))])], QXSingle('H')), QXMeasure([QXBind('y'), QXBind('p')], QXBind("q'")), QXAssert(QXBin('', QXBind('y'), QXBind('H_check'))), QXAssert(QXComp('==', QXCall('F', [QXBind('y'), QXBind('a')]), QXBind('a'))), QXCAssign([QXBind('h')], QXBin('+', QXBind('h'), QXSet([QXBind('y')]))), QXCAssign([QXBind('i')], QXBin('+', QXBind('i'), QXNum(1)))]), QXIf(QXComp('==', QXBind('h'), QXBind('H_check')), [QXReturn([QXBind('h')])], None), QXReturn([QXBind('null')])])]),
    QXProgram([QXMethod('swap', False, [QXBind('q', type=TyQ(QXBind('n'))), QXBind('p', type=TyQ(QXBind('n'))), QXBind('n', type=TySingle('nat'))], [], [QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXCall('old', [QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])])])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXCall('old', [QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])])])]))], [QXFor('j', QXCRange(QXNum(0), QXBind('n')), [], [QXIf(QXQRange('p', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))]), [QXQAssign([QXQRange('q', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('x'), QXNum(1)))]))], None), QXIf(QXQRange('q', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))]), [QXQAssign([QXQRange('p', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('x'), QXNum(1)))]))], None), QXIf(QXQRange('p', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))]), [QXQAssign([QXQRange('q', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))])], QXOracle([QXBind('x')], QXCall('omega', [QXNum(0), QXNum(1)]), [QXSKet(QXBin('+', QXBind('x'), QXNum(1)))]))], None)])]), QXMethod('permLoop', False, [QXBind('r', type=TyArray(TyQ(QXBind('k')), QXBind('n'))), QXBind('q', type=TyArray(TyQ(QXBind('k')), QXBind('n'))), QXBind('p', type=TyArray(TyQ(QXBind('k')), QXBind('n'))), QXBind('t', type=TySingle('nat')), QXBind('k', type=TySingle('nat')), QXBind('n', type=TySingle('nat'))], [], [QXEnsures(QXQSpec([QXQRange('q', [QXCRange(QXBind('t'), QXBin('+', QXBind('t'), QXNum(1))), QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXCall('old', [QXQRange('p', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1))), QXCRange(QXNum(0), QXBind('n'))])])])])), QXEnsures(QXQSpec([QXQRange('p', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1))), QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXCall('old', [QXQRange('q', [QXCRange(QXBind('t'), QXBin('+', QXBind('t'), QXNum(1))), QXCRange(QXNum(0), QXBind('n'))])])])]))], [QXFor('j', QXCRange(QXNum(0), QXBind('k')), [], QXIf(QXComp('==', QXQRange('r', [QXCRange(QXBind('j'), QXBin('+', QXBind('j'), QXNum(1)))]), QXBind('k')), [QXCall('swap', [QXBind('q'), QXQRange('p', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1)))]), QXBind('n')])], None))]), QXMethod('StateDist', False, [QXBind('r', type=TyArray(TyQ(QXBind('k')), QXBind('n'))), QXBind('q', type=TyArray(TyQ(QXBind('k')), QXBind('n'))), QXBind('p', type=TyArray(TyQ(QXBind('k')), QXBind('n'))), QXBind('m', type=TySingle('nat')), QXBind('n', type=TySingle('nat'))], [QXBind('y', type=TySingle('nat')), QXBind('prob', type=TySingle('real'))], [QXRequires(QXAll(QXBind('j'), QXComp('<=', QXNum(0), QXComp('<', QXBind('j'), QXBind('k'))), QXQSpec([QXQRange('r', [QXCRange(QXBind('k'), QXBin('+', QXBind('k'), QXNum(1))), QXCRange(QXNum(0), QXBind('n'))])], TyNor(), [QXTensor([QXSKet(QXNum(0))])]))), QXRequires(QXQSpec([QXQRange('q', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXBind('u')])])), QXRequires(QXQSpec([QXQRange('p', [QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXBind('v')])])), QXEnsures(QXLogic('==>', QXComp('==', QXBind('u'), QXBind('v')), QXLogic('==>', QXComp('==', QXBind('y'), QXNum(1)), QXComp('==', QXBind('prob'), QXNum(0))))), QXEnsures(QXLogic('==>', QXComp('!=', QXBind('u'), QXBind('v')), QXLogic('==>', QXComp('==', QXBind('y'), QXNum(1)), QXComp('==', QXBind('prob'), QXBin('-', QXBin('/', QXNum(1), QXNum(2)), QXBin('*', QXBin('/', QXNum(1), QXNum(2)), QXCall('norm', [QXBind('u'), QXBind('v')])))))))], [QXCall('permInit', [QXBind('r'), QXBind('n'), QXBind('k')]), QXFor('t', QXCRange(QXNum(0), QXBind('k')), [], [QXFor('w', QXCRange(QXNum(0), QXBind('k')), [QXInvariant(QXQSpec([QXQRange('q', [QXCRange(QXBind('w'), QXBin('+', QXBind('w'), QXNum(1))), QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXCall('old', [QXQRange('p', [QXCRange(QXBind('t'), QXBin('+', QXBind('t'), QXNum(1))), QXCRange(QXNum(0), QXBind('n'))])])])])), QXInvariant(QXQSpec([QXQRange('p', [QXCRange(QXBind('t'), QXBin('+', QXBind('t'), QXNum(1))), QXCRange(QXNum(0), QXBind('n'))])], TyEn(QXNum(1)), [QXTensor([QXCall('old', [QXQRange('q', [QXCRange(QXBind('w'), QXBin('+', QXBind('w'), QXNum(1))), QXCRange(QXNum(0), QXBind('n'))])])])]))], QXIf(QXComp('==', QXQRange('r', [QXCRange(QXBind('w'), QXBin('+', QXBind('w'), QXNum(1)))]), QXBind('t')), [QXCall('swap', [QXQRange('q', [QXCRange(QXBind('w'), QXBin('+', QXBind('w'), QXNum(1)))]), QXQRange('p', [QXCRange(QXBind('t'), QXBin('+', QXBind('t'), QXNum(1)))]), QXBind('n')])], None))]), QXCall('permInit', [QXBind('r'), QXBind('n'), QXBind('k')]), QXMeasure([QXBind('y'), QXBind('prob')], QXBind('r'))])])
]


class ParseError(Exception):
    pass

class TestProgramTransformer(TestSuite):

    def parse_file(self, filename: str):
        '''Parses a file, returning the ANTLR astract syntax tree.'''

        file_stream = FileStream(filename, encoding='utf-8')
        lexer = ExpLexer(file_stream)
        token_stream = CommonTokenStream(lexer)
        parser = ExpParser(token_stream)
        root = parser.program()

        if parser.getNumberOfSyntaxErrors() > 0:
            # fail
            raise ParseError(f'Failed to parse: {filename}')

        return root

    def convert_file(self, ast):
        '''Attempts to convert a file to the Qafny Programmer AST.'''
        program_transformer = ProgramTransformer()
        qafny_ast = program_transformer.visit(ast)

        return qafny_ast

    def test_program_transformer(self):
        for i, filename in enumerate(suite.TEST_FILES):
            should_test = self.start_case(filename, f'Failed to transform: {filename}')

            if not should_test:
                continue

            antlr_ast = self.parse_file(filename)
            qafny_ast = self.convert_file(antlr_ast)

            # check the ast against .... what?
            # print(qafny_ast)
            # pprint.pp(qafny_ast.__dict__)
            self.console.print("Transformed output:")
            pprint(qafny_ast, console=self.console)
            # Transform the representation into a one-liner
            self.console.print("One-liner:")
            self.printRichReprInOneLine(qafny_ast)
            
            correct = TRANSFORMED_CASES[i] == qafny_ast if i < len(TRANSFORMED_CASES) and TRANSFORMED_CASES[i] is not None else True

            if not correct:
                # pprint(TRANSFORMED_CASES[i])
                # self.console.print(Columns([Pretty(qafny_ast), Pretty(TRANSFORMED_CASES[i])]))
                # self.console.print("[white on red]This is an error line![/]")
                comparison_table = Table(box=box.MINIMAL)
                comparison_table.add_column("Expected")
                comparison_table.add_column("Result")

                comparison_table.add_row(Pretty(TRANSFORMED_CASES[i], indent_size=2), Pretty(qafny_ast, indent_size=2))
                self.console.print(comparison_table)

            self.end_case(correct)

    def test_merge_states(self):
        program_transformer = ProgramTransformer()

        # assert == program_transformer.mergeStates(, )

    # Result = Iterable[Union[Any, Tuple[Any], Tuple[str, Any], Tuple[str, Any, Any]]]
    def printRichReprInOneLine(self, obj: Any):
        '''A recursive function that prints a rich representation in one line.'''

        #  Helper Functions 
        def iter_rich_args(rich_args: Any) -> Iterable[Union[Any, Tuple[str, Any]]]:
            '''Iterate through all __rich_repr__ args. Copied from: https://github.com/Textualize/rich/blob/8c4d3d1d50047e3aaa4140d0ffc1e0c9f1df5af4/rich/pretty.py#L633'''
            for arg in rich_args:
                if isinstance(arg, tuple):
                    if len(arg) == 3:
                        key, child, default = arg
                        if default == child:
                            continue
                        yield key, child
                    elif len(arg) == 2:
                        key, child = arg
                        yield key, child
                    elif len(arg) == 1:
                        yield arg[0]
                else:
                    yield arg

        #  Body code 
        representation = None
        if hasattr(obj, "__rich_repr__") and not inspect.isclass(obj):
            representation = obj.__rich_repr__()

        if representation is not None:
            # object has __rich_repr__

            self.console.print(obj.__class__.__name__ + '(', end='')

            for i, section in enumerate(iter_rich_args(representation)):
                if i > 0:
                    self.console.print(', ', end='')  # print commas between children

                if isinstance(section, tuple):
                    # key and child
                    key, child = section
                    self.console.print(f'{key}=', end='')
                    self.printRichReprInOneLine(child)
                else:
                    self.printRichReprInOneLine(section)

            self.console.print(')', end='')
        elif isinstance(obj, utils.CONTAINERS):
            # container, handle every child
            for test_container_type in utils.CONTAINERS:
                if isinstance(obj, test_container_type):
                    container_type = test_container_type

            open_brace, close_brace, empty = utils.BRACES[container_type](obj)
            
            self.console.print(open_brace, end='')

            if isinstance(obj, utils.MAPPING_CONTAINERS):
                # map
                pass
            else:
                # normal container
                for i, child in enumerate(iter(obj)):
                    if i > 0:
                        self.console.print(', ', end='')
                        
                    self.printRichReprInOneLine(child)

            self.console.print(close_brace, end='')

        else:
            # value, print it out
            self.console.print(repr(obj), end='')


def run():
    test_suite = TestProgramTransformer()
    test_suite.run()


if __name__ == '__main__':
    run()